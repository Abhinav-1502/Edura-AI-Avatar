# Homework Chat API Documentation

This API allows you to create stateful chat sessions for students where the AI Tutor has immediate access to their specific context (e.g., Grade Reports, Student Name) without needing to re-upload this data with every message.

## Base URL
All endpoints are relative to your backend API URL (e.g., `http://localhost:8000` or `https://api.edura.app`).

## Endpoints

### 1. Start a Session
Initialize a new chat session by providing the student's background information. The server caches this context.

**Endpoint:** `POST /api/hw/session/start`

**Request Body:**
```json
{
  "student_data": {
    "name": "Alice Johnson",
    "id": "student_123",
    "grade_level": "10th"
  },
  "grade_report": "Math: A-\nScience: B+\nHistory: A\nEnglish: C\n\nOverall, Alice is doing well but struggles slightly with English literature concepts..."
}
```

**Response:**
```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Session started successfully"
}
```

---

### 2. Send a Message
Send a chat message to the specific session. The AI uses the context provided in the `start` call to generate relevant answers.

**Endpoint:** `POST /api/hw/chat/{session_id}`

**Request Body:**
```json
{
  "message": "Why is my English grade so low?",
  "history": [
    { "role": "user", "content": "Hello!" },
    { "role": "assistant", "content": "Hi Alice! How can I help you with your grades today?" }
  ]
}
```
*Note: `history` is optional. Include it if you want the AI to remember previous turns in the conversation.*

**Response:**
*   **Format:** Server-Sent Events (SSE) stream.
*   **Content:** The stream returns chunks of text as they are generated by the LLM.

**Example Stream:**
```
data: {"id":"...","choices":[{"delta":{"content":"Your "}}]}
data: {"id":"...","choices":[{"delta":{"content":"English "}}]}
...
data: [DONE]
```

---

### 3. End Session
Free up server resources by deleting the session when the user leaves or the conversation ends.

**Endpoint:** `DELETE /api/hw/session/{session_id}`

**Response:**
```json
{
  "message": "Session ended and context cleared"
}
```

## Example Workflow (JavaScript)

```javascript
const BASE_URL = 'http://localhost:8000';

async function startHomeworkHelp() {
    // 1. Start Session
    const startRes = await fetch(`${BASE_URL}/api/hw/session/start`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            student_data: { name: "Alice" },
            grade_report: "Math: B. Student shows improvement in algebra."
        })
    });
    const { session_id } = await startRes.json();
    console.log("Session ID:", session_id);

    // 2. Chat
    const chatRes = await fetch(`${BASE_URL}/api/hw/chat/${session_id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            message: "How can I improve my Math grade?"
        })
    });

    // 3. Read Stream
    const reader = chatRes.body.getReader();
    const decoder = new TextDecoder();
    
    while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value);
        console.log("Received chunk:", chunk);
    }
}
```
